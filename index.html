<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êñ∞Âπ¥Á•ùÁ¶èÂºπÂπï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", sans-serif;
        }

        body {
            background: linear-gradient(180deg, #e6f3ff 0%, #f0f8ff 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }

        .control-panel textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: none;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .control-panel button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #startBtn {
            background: #ff6b81;
            color: white;
            margin-right: 10px;
        }

        #startBtn:hover {
            background: #ff4757;
        }

        #generateLinkBtn {
            background: #70a1ff;
            color: white;
        }

        #generateLinkBtn:hover {
            background: #5380e8;
        }

        #linkContainer {
            margin-top: 12px;
            padding: 12px;
            background: #f1f2f6;
            border-radius: 8px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        #linkInput {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
        }

        #copyBtn {
            background: #5ebe7f;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            white-space: nowrap;
        }

        #canvas {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 600px;
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .message-card {
            position: absolute;
            width: 60%;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease-out;
        }

        .card-header {
            display: flex;
            align-items: center;
            padding: 6px 10px;
            font-weight: bold;
            font-size: 14px;
        }

        .heart-icon {
            margin-right: 6px;
            font-size: 14px;
        }

        .card-body {
            padding: 12px;
            background: white;
            font-size: 16px;
            text-align: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <h1>Êñ∞Âπ¥Á•ùÁ¶èÂºπÂπï üíå</h1>
    <div class="control-panel">
        <textarea id="messageInput" placeholder="ËØ∑ËæìÂÖ•Êñ∞Âπ¥Á•ùÁ¶èÔºåÊØèË°å‰∏ÄÊù°"></textarea>
        <button id="startBtn">ÂºÄÂßãÊí≠ÊîæÂºπÂπï</button>
        <button id="generateLinkBtn">ÁîüÊàêÂàÜ‰∫´ÈìæÊé•</button>
        <div id="linkContainer">
            <input type="text" id="linkInput" readonly>
            <button id="copyBtn">Â§çÂà∂ÈìæÊé•</button>
        </div>
    </div>
    <div id="canvas"></div>

    <script>
        const canvas = document.getElementById('canvas');
        const messageInput = document.getElementById('messageInput');
        const startBtn = document.getElementById('startBtn');
        const generateLinkBtn = document.getElementById('generateLinkBtn');
        const linkContainer = document.getElementById('linkContainer');
        const linkInput = document.getElementById('linkInput');
        const copyBtn = document.getElementById('copyBtn');

        const headerColors = [
            { top: '#ffd699', body: '#fff9e6', heart: 'üíõ' },
            { top: '#ff99cc', body: '#ffe6f2', heart: 'üíñ' },
            { top: '#99e6ff', body: '#e6f9ff', heart: 'üß°' },
            { top: '#cc99ff', body: '#f2e6ff', heart: 'üíù' },
            { top: '#ff9999', body: '#ffe6e6', heart: '‚ù§Ô∏è' },
            { top: '#99ccff', body: '#e6f2ff', heart: 'üíô' }
        ];

        let intervalId = null;
        let currentLink = '';

        // ‰ªéURLÂä†ËΩΩÂπ∂Ëá™Âä®Êí≠Êîæ
        function loadMessagesFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const encoded = params.get('messages');
            if (encoded) {
                try {
                    const messages = decodeURIComponent(encoded).split('\n');
                    messageInput.value = messages.join('\n');
                    setTimeout(startPlayback, 300);
                } catch (e) {
                    console.error('Âä†ËΩΩÊ∂àÊÅØÂ§±Ë¥•:', e);
                }
            }
        }

        // ÁîüÊàêÈìæÊé•
        function generateShareLink() {
            const messages = messageInput.value.trim();
            if (!messages) {
                alert('ËØ∑ÂÖàËæìÂÖ•Á•ùÁ¶èÂÜÖÂÆπÔºÅ');
                return;
            }
            const encoded = encodeURIComponent(messages);
            currentLink = window.location.origin + window.location.pathname + '?messages=' + encoded;
            linkInput.value = currentLink;
            linkContainer.style.display = 'flex';
        }

        // Â§çÂà∂ÈìæÊé•ÔºàÂÖºÂÆπÊâÄÊúâÊµèËßàÂô®Ôºâ
        copyBtn.onclick = function () {
            if (!currentLink) return;
            linkInput.select();
            linkInput.setSelectionRange(0, 99999);
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    copyBtn.textContent = 'Â∑≤Â§çÂà∂ÔºÅ';
                    setTimeout(() => { copyBtn.textContent = 'Â§çÂà∂ÈìæÊé•'; }, 1500);
                } else {
                    alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂ÈìæÊé•„ÄÇ');
                }
            } catch (err) {
                console.error('Â§çÂà∂Â§±Ë¥•:', err);
                alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂ÈìæÊé•„ÄÇ');
            }
        };

        // Êí≠ÊîæÂºπÂπï
        function startPlayback() {
            if (intervalId) clearInterval(intervalId);
            canvas.innerHTML = '';
            const messages = messageInput.value.trim().split('\n').filter(x => x.trim());
            if (!messages.length) {
                alert('ËØ∑ËæìÂÖ•Ëá≥Â∞ë‰∏ÄÊù°Á•ùÁ¶èÔºÅ');
                return;
       